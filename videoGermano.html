<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Plyr com post-roll travado (YouTube)</title>

  <!-- CSS do Plyr -->
  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />

  <style>
    body {
      background: #111;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    /* Player fixo */
    #player {
      width: 960px;
      height: 540px;
      background: black;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
    }

    #player iframe {
      width: 100%;
      height: 100%;
    }

    /* Cor do player */
    :root {
      --plyr-color-main: #25B895;
    }

    /* Overlay para travar clique durante anúncio */
    .overlay-lock {
      position: absolute;
      inset: 0;
      z-index: 10;
      background: rgba(0, 0, 0, 0);
      display: none;
    }
  </style>
</head>
<body>

  <div style="position: relative;">
    <div class="plyr__video-embed" id="player">
      <iframe
        src="https://www.youtube.com/embed/0pdqf4P9MB8?playsinline=1&enablejsapi=1"
        allowfullscreen
        allow="autoplay"
      ></iframe>
    </div>
    <div id="lock" class="overlay-lock"></div>
  </div>

  <!-- JS do Plyr -->
  <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
  <script>
    const player = new Plyr('#player', {
      youtube: { rel: 0, modestbranding: 1 },
      autoplay: true,
    });

    const videos = [
      { id: '0pdqf4P9MB8', title: 'Conteúdo principal' },
      { id: '_lwMF0F_Amw', title: 'Anúncio' },
    ];

    let currentIndex = 0;
    let isChanging = false;
    const lockOverlay = document.getElementById('lock');

    // Função para trocar de vídeo
    function loadVideo(index) {
      const next = videos[index];
      if (!next) return;

      isChanging = true;
      player.source = {
        type: 'video',
        sources: [{ src: next.id, provider: 'youtube' }],
        title: next.title,
      };

      // Aguarda o player estar pronto antes de tocar
      player.once('ready', () => {
        player.muted = true;
        player.play().then(() => {
          player.muted = false;
          isChanging = false;

          // Se for o anúncio, só depois do "ready" aplica bloqueio
          if (index === 1) {
            lockOverlay.style.display = 'block';
            player.toggleControls(false);
          } else {
            lockOverlay.style.display = 'none';
            player.toggleControls(true);
          }
        }).catch(err => {
          console.warn('Autoplay bloqueado:', err);
          isChanging = false;
        });
      });
    }

    // Quando o vídeo termina
    player.on('ended', () => {
      if (isChanging) return;
      currentIndex++;
      if (currentIndex < videos.length) {
        loadVideo(currentIndex);
      } else {
        console.log('Todos os vídeos concluídos.');
        lockOverlay.style.display = 'none';
        player.toggleControls(true);
      }
    });

    // Inicializa o primeiro vídeo
    loadVideo(currentIndex);
  </script>
</body>
</html>
